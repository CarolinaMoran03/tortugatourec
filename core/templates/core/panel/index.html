{% extends "core/base.html" %}
{% block title %}Admin Dashboard | TortugaTur{% endblock %}

{% block content %}
<main class="bg-[#f8fafc] min-h-screen py-16" role="main">
    <div class="max-w-7xl mx-auto px-6 lg:px-8">

        <header class="relative mb-12">
            <div class="flex flex-col md:flex-row md:items-end justify-between gap-4">
                <div>
                    <span
                        class="text-primary font-black uppercase tracking-[0.3em] text-[10px] bg-primary/10 px-4 py-2 rounded-full mb-4 inline-block">Management
                        Console</span>
                    <h1 class="text-4xl font-black text-slate-900 tracking-tight flex items-center gap-4">
                        Panel <span
                            class="text-primary underline decoration-slate-200 underline-offset-8">Administrativo</span>
                    </h1>
                    <p class="text-slate-500 mt-4 max-w-2xl text-lg font-medium">
                        Bienvenido, <span class="text-slate-900 font-bold">{{ user.username }}</span>. Central de
                        control para operaciones, destinos y logística de TortugaTur.
                    </p>
                </div>

                <div class="hidden lg:flex items-center gap-3 bg-white p-2 rounded-2xl shadow-sm border border-slate-100"
                    aria-label="Estado del sistema">
                    <div class="w-12 h-12 bg-emerald-50 text-emerald-600 rounded-xl flex items-center justify-center">
                        <span class="material-icons" aria-hidden="true">check_circle</span>
                    </div>
                    <div class="pr-4">
                        <p class="text-[10px] uppercase font-black text-slate-400">Estado del Sistema</p>
                        <p class="text-sm font-bold text-slate-800">Operacional</p>
                    </div>
                </div>
            </div>
        </header>

        <nav class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-8" aria-label="Funciones principales">

            {% if request.user.is_superuser or request.user.is_staff %}
            <a href="{% url 'destinos' %}"
                class="group relative bg-white p-10 rounded-[2.5rem] border border-slate-100 shadow-sm hover:shadow-2xl hover:shadow-primary/10 transition-all duration-500 hover:-translate-y-2 overflow-hidden"
                aria-label="Administrar rutas y destinos">
                <div
                    class="absolute top-0 right-0 w-32 h-32 bg-purple-500/5 rounded-bl-[5rem] transition-transform group-hover:scale-110">
                </div>
                <div class="relative z-10">
                    <div class="w-16 h-16 bg-slate-50 rounded-2xl text-purple-600 flex items-center justify-center group-hover:bg-purple-600 group-hover:text-white transition-all duration-500 shadow-inner"
                        aria-hidden="true">
                        <span class="material-icons text-3xl">map</span>
                    </div>
                    <div class="mt-8">
                        <h3 class="text-2xl font-black text-slate-900 group-hover:text-purple-600 transition-colors">
                            Destinos</h3>
                        <p class="mt-3 text-slate-500 leading-relaxed font-medium">
                            Gestiona las islas y puntos de visita. Optimiza la información geográfica de Galápagos.
                        </p>
                    </div>
                    <div
                        class="mt-8 flex items-center gap-2 text-slate-900 font-black text-xs uppercase tracking-widest border-t border-slate-50 pt-6">
                        Editar Mapas <span class="material-icons text-sm group-hover:translate-x-2 transition-transform"
                            aria-hidden="true">arrow_forward</span>
                    </div>
                </div>
            </a>

            <a href="{% url 'admin_tours' %}"
                class="group relative bg-white p-10 rounded-[2.5rem] border border-slate-100 shadow-sm hover:shadow-2xl hover:shadow-primary/10 transition-all duration-500 hover:-translate-y-2 overflow-hidden"
                aria-label="Gestionar catálogo de tours">
                <div
                    class="absolute top-0 right-0 w-32 h-32 bg-primary/5 rounded-bl-[5rem] transition-transform group-hover:scale-110">
                </div>
                <div class="relative z-10">
                    <div class="w-16 h-16 bg-slate-50 rounded-2xl text-primary flex items-center justify-center group-hover:bg-primary group-hover:text-white transition-all duration-500 shadow-inner"
                        aria-hidden="true">
                        <span class="material-icons text-3xl">beach_access</span>
                    </div>
                    <div class="mt-8">
                        <h3 class="text-2xl font-black text-slate-900 group-hover:text-primary transition-colors">
                            Catálogo de Tours</h3>
                        <p class="mt-3 text-slate-500 leading-relaxed font-medium">
                            Diseña experiencias únicas. Edita itinerarios, galerías de fotos y precios por temporada.
                        </p>
                    </div>
                    <div
                        class="mt-8 flex items-center gap-2 text-slate-900 font-black text-xs uppercase tracking-widest border-t border-slate-50 pt-6">
                        Configurar Experiencias <span
                            class="material-icons text-sm group-hover:translate-x-2 transition-transform"
                            aria-hidden="true">arrow_forward</span>
                    </div>
                </div>
            </a>
            {% endif %}

            <a href="{% url 'admin_salidas' %}"
                class="group relative bg-white p-10 rounded-[2.5rem] border border-slate-100 shadow-sm hover:shadow-2xl hover:shadow-primary/10 transition-all duration-500 hover:-translate-y-2 overflow-hidden"
                aria-label="Gestionar disponibilidad y cupos">
                <div
                    class="absolute top-0 right-0 w-32 h-32 bg-emerald-500/5 rounded-bl-[5rem] transition-transform group-hover:scale-110">
                </div>
                <div class="relative z-10">
                    <div class="w-16 h-16 bg-slate-50 rounded-2xl text-emerald-600 flex items-center justify-center group-hover:bg-emerald-600 group-hover:text-white transition-all duration-500 shadow-inner"
                        aria-hidden="true">
                        <span class="material-icons text-3xl">calendar_today</span>
                    </div>
                    <div class="mt-8">
                        <h3 class="text-2xl font-black text-slate-900 group-hover:text-emerald-600 transition-colors">
                            Disponibilidad</h3>
                        <p class="mt-3 text-slate-500 leading-relaxed font-medium">
                            Control de inventario. Ajusta cupos máximos por fecha y bloquea días feriados.
                        </p>
                    </div>
                    <div
                        class="mt-8 flex items-center gap-2 text-slate-900 font-black text-xs uppercase tracking-widest border-t border-slate-50 pt-6">
                        Abrir Frecuencias <span
                            class="material-icons text-sm group-hover:translate-x-2 transition-transform"
                            aria-hidden="true">arrow_forward</span>
                    </div>
                </div>
            </a>

            {% if request.user.is_superuser or request.user.is_staff %}
            <a href="{% url 'admin_reservas' %}"
                class="group relative bg-white p-10 rounded-[2.5rem] border border-slate-100 shadow-sm hover:shadow-2xl hover:shadow-primary/10 transition-all duration-500 hover:-translate-y-2 overflow-hidden"
                aria-label="Gestionar reservas y ventas">
                <div
                    class="absolute top-0 right-0 w-32 h-32 bg-secondary/5 rounded-bl-[5rem] transition-transform group-hover:scale-110">
                </div>
                <div class="relative z-10">
                    <div class="w-16 h-16 bg-slate-50 rounded-2xl text-secondary flex items-center justify-center group-hover:bg-secondary group-hover:text-white transition-all duration-500 shadow-inner"
                        aria-hidden="true">
                        <span class="material-icons text-3xl">assignment</span>
                    </div>
                    <div class="mt-8">
                        <h3 class="text-2xl font-black text-slate-900 group-hover:text-secondary transition-colors">
                            Flujo de Ventas</h3>
                        <p class="mt-3 text-slate-500 leading-relaxed font-medium">
                            Monitorea transacciones, aprueba pagos pendientes y gestiona el check-in de viajeros.
                        </p>
                    </div>
                    <div
                        class="mt-8 flex items-center gap-2 text-slate-900 font-black text-xs uppercase tracking-widest border-t border-slate-50 pt-6">
                        Revisar Historial <span
                            class="material-icons text-sm group-hover:translate-x-2 transition-transform"
                            aria-hidden="true">arrow_forward</span>
                    </div>
                </div>
            </a>
            {% endif %}

            <a href="{% url 'secretaria_reservar' %}"
                class="group relative bg-white p-10 rounded-[2.5rem] border border-slate-100 shadow-sm hover:shadow-2xl hover:shadow-primary/10 transition-all duration-500 hover:-translate-y-2 overflow-hidden"
                aria-label="Crear reserva para cliente por secretaria">
                <div
                    class="absolute top-0 right-0 w-32 h-32 bg-pink-500/5 rounded-bl-[5rem] transition-transform group-hover:scale-110">
                </div>
                <div class="relative z-10">
                    <div class="w-16 h-16 bg-slate-50 rounded-2xl text-pink-600 flex items-center justify-center group-hover:bg-pink-600 group-hover:text-white transition-all duration-500 shadow-inner"
                        aria-hidden="true">
                        <span class="material-icons text-3xl">support_agent</span>
                    </div>
                    <div class="mt-8">
                        <h3 class="text-2xl font-black text-slate-900 group-hover:text-pink-600 transition-colors">
                            Reserva Asistida</h3>
                        <p class="mt-3 text-slate-500 leading-relaxed font-medium">
                            La secretaria busca tours por fecha, registra los datos del cliente y crea la reserva en
                            nombre del pasajero.
                        </p>
                    </div>
                    <div
                        class="mt-8 flex items-center gap-2 text-slate-900 font-black text-xs uppercase tracking-widest border-t border-slate-50 pt-6">
                        Crear Reserva <span
                            class="material-icons text-sm group-hover:translate-x-2 transition-transform"
                            aria-hidden="true">arrow_forward</span>
                    </div>
                </div>
            </a>

            {% if request.user.is_superuser or request.user.is_staff %}
            <a href="{% url 'admin_secretarias' %}"
                class="group relative bg-white p-10 rounded-[2.5rem] border border-slate-100 shadow-sm hover:shadow-2xl hover:shadow-primary/10 transition-all duration-500 hover:-translate-y-2 overflow-hidden"
                aria-label="Gestionar usuarios de secretaria">
                <div
                    class="absolute top-0 right-0 w-32 h-32 bg-amber-500/5 rounded-bl-[5rem] transition-transform group-hover:scale-110">
                </div>
                <div class="relative z-10">
                    <div class="w-16 h-16 bg-slate-50 rounded-2xl text-amber-600 flex items-center justify-center group-hover:bg-amber-600 group-hover:text-white transition-all duration-500 shadow-inner"
                        aria-hidden="true">
                        <span class="material-icons text-3xl">manage_accounts</span>
                    </div>
                    <div class="mt-8">
                        <h3 class="text-2xl font-black text-slate-900 group-hover:text-amber-600 transition-colors">
                            Usuarios Secretaria</h3>
                        <p class="mt-3 text-slate-500 leading-relaxed font-medium">
                            Crea credenciales de acceso para secretarias con permiso exclusivo para reservas asistidas.
                        </p>
                    </div>
                    <div
                        class="mt-8 flex items-center gap-2 text-slate-900 font-black text-xs uppercase tracking-widest border-t border-slate-50 pt-6">
                        Gestionar Cuentas <span
                            class="material-icons text-sm group-hover:translate-x-2 transition-transform"
                            aria-hidden="true">arrow_forward</span>
                    </div>
                </div>
            </a>

            <a href="{% url 'admin_agencias' %}"
                class="group relative bg-white p-10 rounded-[2.5rem] border border-slate-100 shadow-sm hover:shadow-2xl hover:shadow-primary/10 transition-all duration-500 hover:-translate-y-2 overflow-hidden"
                aria-label="Administrar permisos de Agencias">
                <div
                    class="absolute top-0 right-0 w-32 h-32 bg-amber-500/5 rounded-bl-[5rem] transition-transform group-hover:scale-110">
                </div>
                <div class="relative z-10">
                    <div class="w-16 h-16 bg-slate-50 rounded-2xl text-amber-600 flex items-center justify-center group-hover:bg-amber-600 group-hover:text-white transition-all duration-500 shadow-inner"
                        aria-hidden="true">
                        <span class="material-icons text-3xl">storefront</span>
                    </div>
                    <div class="mt-8">
                        <h3 class="text-2xl font-black text-slate-900 group-hover:text-amber-600 transition-colors">
                            Agencias Asociadas</h3>
                        <p class="mt-3 text-slate-500 leading-relaxed font-medium">
                            Concede o retira permisos a usuarios para bloquear reservas con penalidad de 15 dias.
                        </p>
                    </div>
                    <div
                        class="mt-8 flex items-center gap-2 text-slate-900 font-black text-xs uppercase tracking-widest border-t border-slate-50 pt-6">
                        Gestionar Permisos <span
                            class="material-icons text-sm group-hover:translate-x-2 transition-transform"
                            aria-hidden="true">arrow_forward</span>
                    </div>
                </div>
            </a>

            <a href="{% url 'panel_galeria' %}"
                class="group relative bg-white p-10 rounded-[2.5rem] border border-slate-100 shadow-sm hover:shadow-2xl hover:shadow-primary/10 transition-all duration-500 hover:-translate-y-2 overflow-hidden"
                aria-label="Gestionar fotos de la galería">
                <div
                    class="absolute top-0 right-0 w-32 h-32 bg-blue-500/5 rounded-bl-[5rem] transition-transform group-hover:scale-110">
                </div>
                <div class="relative z-10">
                    <div class="w-16 h-16 bg-slate-50 rounded-2xl text-blue-600 flex items-center justify-center group-hover:bg-blue-600 group-hover:text-white transition-all duration-500 shadow-inner"
                        aria-hidden="true">
                        <span class="material-icons text-3xl">photo_library</span>
                    </div>
                    <div class="mt-8">
                        <h3 class="text-2xl font-black text-slate-900 group-hover:text-blue-600 transition-colors">
                            Galería de Fotos</h3>
                        <p class="mt-3 text-slate-500 leading-relaxed font-medium">
                            Sube imágenes locales o agrega URLs de Google Drive para enriquecer los tours y reseñas
                            visuales.
                        </p>
                    </div>
                    <div
                        class="mt-8 flex items-center gap-2 text-slate-900 font-black text-xs uppercase tracking-widest border-t border-slate-50 pt-6">
                        Administrar Galería <span
                            class="material-icons text-sm group-hover:translate-x-2 transition-transform"
                            aria-hidden="true">arrow_forward</span>
                    </div>
                </div>
            </a>
            {% endif %}

        </nav>

        {% if request.user.is_superuser or request.user.is_staff %}
        <section class="mt-16 bg-white p-8 rounded-[2.5rem] border border-slate-100 shadow-sm relative overflow-hidden"
            aria-label="Actividad de Secretarias">
            <h2 class="text-2xl font-black text-slate-900 mb-6 flex items-center gap-3">
                <span class="material-icons text-primary">history</span> Actividad Reciente de Secretarías
            </h2>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Columna Reservas -->
                <div>
                    <h3 class="text-sm font-bold text-slate-500 uppercase tracking-widest mb-4">Últimas Reservas
                        (Ventas)</h3>
                    {% if actividad_reservas %}
                    <ul class="space-y-4">
                        {% for res in actividad_reservas %}
                        <li
                            class="bg-slate-50 p-4 rounded-xl border border-slate-100 flex justify-between items-center group hover:bg-white transition-all">
                            <div>
                                <p class="text-sm font-bold text-slate-800">
                                    <span class="text-xs mr-2 text-slate-400">#{{ res.id|stringformat:"05d" }}</span>
                                    {{ res.nombre }} {{ res.apellidos }}
                                </p>
                                <p class="text-xs text-slate-500 mt-1 flex items-center gap-1">
                                    <span class="material-icons text-[14px]">map</span> {{ res.salida.tour.nombre }}
                                </p>
                            </div>
                            <div class="text-right">
                                <p class="text-sm font-black text-slate-900">${{ res.total_pagar }}</p>
                                <p class="text-[10px] uppercase font-bold text-primary mt-1">{{ res.creado_por.username }}</p>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    <p class="text-sm text-slate-400 italic">No hay reservas recientes hechas por secretarias.</p>
                    {% endif %}
                </div>

                <!-- Columna Salidas -->
                <div>
                    <h3 class="text-sm font-bold text-slate-500 uppercase tracking-widest mb-4">Últimas Disponibilidades
                    </h3>
                    {% if actividad_salidas %}
                    <ul class="space-y-4">
                        {% for sal in actividad_salidas %}
                        <li
                            class="bg-slate-50 p-4 rounded-xl border border-slate-100 flex justify-between items-center group hover:bg-white transition-all">
                            <div>
                                <p class="text-sm font-bold text-slate-800">
                                    <span class="text-xs mr-2 text-slate-400">#{{ sal.id|stringformat:"05d" }}</span>
                                    {{ sal.tour.nombre }}
                                </p>
                                <p class="text-xs text-slate-500 mt-1 flex items-center gap-1">
                                    <span class="material-icons text-[14px]">calendar_today</span> {{ sal.fecha|date:"d M Y" }}
                                </p>
                            </div>
                            <div class="text-right">
                                <p class="text-sm font-black text-slate-900">{{ sal.cupos_disponibles }} cupos</p>
                                <p class="text-[10px] uppercase font-bold text-primary mt-1">{{ sal.creado_por.username }}</p>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    <p class="text-sm text-slate-400 italic">No hay frecuencias recientes hechas por secretarias.</p>
                    {% endif %}
                </div>
            </div>
        </section>
        {% endif %}

        <footer class="mt-16 bg-slate-900 rounded-[3rem] p-8 md:p-12 text-center relative overflow-hidden"
            role="contentinfo">
            <div class="absolute top-0 left-0 w-full h-full opacity-10 pointer-events-none">
                <div class="absolute top-[-10%] left-[-10%] w-64 h-64 bg-primary rounded-full blur-[100px]"></div>
            </div>
            <div class="relative z-10 max-w-2xl mx-auto">
                <span class="material-icons text-primary text-4xl mb-4" aria-hidden="true">security</span>
                <h4 class="text-white text-xl font-bold mb-4">Seguridad del Sistema</h4>
                <p class="text-slate-400 text-sm leading-relaxed">
                    Estás en un área restringida. Todas las modificaciones quedan registradas en el log de auditoría.
                    Asegúrate de cerrar sesión al terminar tu jornada para proteger la integridad de los datos.
                </p>
                <div class="mt-8 flex justify-center gap-4">
                    <form action="{% url 'logout' %}" method="post">
                        {% csrf_token %}
                        <button type="submit"
                            class="bg-white/10 hover:bg-red-500 text-white px-8 py-3 rounded-2xl font-black text-xs uppercase tracking-widest transition-all"
                            aria-label="Cerrar sesión">
                            Finalizar Sesión
                        </button>
                    </form>
                </div>
            </div>
        </footer>
    </div>
</main>

<style>
    /* Se mantienen tus estilos CSS originales */
    body {
        -webkit-font-smoothing: antialiased;
    }

    .shadow-inner {
        box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.05);
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    nav>a {
        animation: fadeInUp 0.6s ease-out forwards;
    }

    nav>a:nth-child(1) {
        animation-delay: 0.1s;
    }

    nav>a:nth-child(2) {
        animation-delay: 0.2s;
    }

    nav>a:nth-child(3) {
        animation-delay: 0.3s;
    }

    nav>a:nth-child(4) {
        animation-delay: 0.4s;
    }

    nav>a {
        position: relative;
    }

    nav>a:hover::after {
        content: attr(aria-label);
        position: absolute;
        bottom: -40px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 14px;
        font-weight: normal;
        white-space: nowrap;
        z-index: 100;
        opacity: 0;
        animation: fadeIn 0.3s forwards;
    }

    @keyframes fadeIn {
        to {
            opacity: 1;
        }
    }
</style>
{% endblock %}